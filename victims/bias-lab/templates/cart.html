{% extends "base.html" %}
{% block title %}Cart | Bias Market{% endblock %}
{% block content %}
<section class="section">
  <div class="section-header">
    <h2>Your cart</h2>
    <p>Review items and move to checkout.</p>
  </div>
  {% if items %}
    {% set tax = total * 0.07 %}
    {% set delivery = 0 if total >= 60 else 5.99 %}
    {% set grand_total = total + tax + delivery %}
    <div class="cart-list">
      {% for item in items %}
      <div class="card cart-item reveal" style="--delay: {{ loop.index0 * 60 }}ms;">
        <div class="cart-media">
          <img src="{{ item['image_url'] }}" alt="{{ item['name'] }}" />
        </div>
        <div class="cart-details">
          <h3>{{ item['name'] }}</h3>
          <p>{{ item['description'] }}</p>
          <span class="tag">{{ item['category'] }}</span>
        </div>
        <div class="cart-meta">
          <div>Qty: {{ item['qty'] }}</div>
          <div>${{ '%.2f'|format(item['line_total']) }}</div>
        </div>
      </div>
      {% endfor %}
    </div>
    <div class="cart-summary">
      <div class="card summary-card">
        <div class="summary-row">
          <span>Subtotal</span>
          <span>${{ '%.2f'|format(total) }}</span>
        </div>
        <div class="summary-row">
          <span>Estimated tax</span>
          <span>${{ '%.2f'|format(tax) }}</span>
        </div>
        <div class="summary-row">
          <span>Delivery</span>
          {% if delivery == 0 %}
            <span>Free</span>
          {% else %}
            <span>${{ '%.2f'|format(delivery) }}</span>
          {% endif %}
        </div>
        <div class="summary-row total-row">
          <span>Total</span>
          <span>${{ '%.2f'|format(grand_total) }}</span>
        </div>
        <form method="post" action="{{ url_for('checkout') }}">
          <button class="btn primary" type="submit">Checkout</button>
        </form>
        <a class="btn ghost" href="{{ url_for('cart_clear') }}">Clear cart</a>
        <p class="muted">Taxes and delivery calculated at checkout.</p>
      </div>
    </div>
  {% else %}
    <div class="card empty-state">
      <h3>Your cart is empty</h3>
      <p>Start with curated essentials and local favorites.</p>
      <a class="btn primary" href="{{ url_for('products') }}">Shop the market</a>
    </div>
  {% endif %}
</section>
{% endblock %}
